$temp_spec

#PBS -lwalltime=$temp_hours_mins:0

$temp_array_place

# Setup environement using .bashrc
source $HOME/.bashrc

# Clone repository and checkout to the given tag name.
git clone git@github.com:A-Alaa/ICE-NODE.git $TMPDIR/ICE-NODE --branch $STUDY_TAG --single-branch  --depth 1 

cd $TMPDIR/ICE-NODE

$HOME/anaconda3/condabin/conda activate $HOME/GP/env/icenode-env

# Load modules
$temp_modules_place

# Run program

OUTPUT_DIR=""
DATA_DIR=""

if [[ "$DATA_TAG" == "M3" ]]; then
  OUTPUT_DIR="$HOME/GP/ehr-data/icenode-m3-exp"
  DATA_DIR="$HOME/GP/ehr-data/mimic3-transforms"
else
  OUTPUT_DIR="$HOME/GP/ehr-data/icenode-m4-exp"
  DATA_DIR="$HOME/GP/ehr-data/mimic4-transforms"
fi

export JAX_PLATFORM_NAME=$temp_platform

$temp_command

mkdir $PBS_O_WORKDIR/$PBS_JOBID
cp * $PBS_O_WORKDIR/$PBS_JOBID
