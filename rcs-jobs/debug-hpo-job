#PBS -lselect=1:ncpus=8:mem=96gb

#PBS -lwalltime=0:30:0

# Setup environement using .bashrc
source $HOME/.bashrc
$HOME/anaconda3/condabin/conda activate icenode

# Clone repository and checkout to the given tag name.
git clone git@github.com:A-Alaa/ICENODE.git $TMPDIR/ICENODE --branch $STUDY_TAG --single-branch 

cd $TMPDIR/ICENODE

# Load modules for any applications

# Run program
$HOME/anaconda3/envs/icenode/bin/python -m icenode.hpo_multi \
--output-dir $HOME/GP/ehr-data/icenode-experiments \
--mimic-processed-dir ~/GP/ehr-data/mimic3-transforms \
--study-tag debug_$STUDY_TAG \
--data-tag $DATA_TAG \
--emb $EMB \
--model $MODEL \
--optuna-store $OPTUNA_STORE \
--mlflow-store $MLFLOW_STORE \
--num-trials 1 \
-N 5 \
--job-id "$PBS_JOBID $PBS_ARRAY_INDEX" \
--trials-time-limit 2 \
--training-time-limit 1 \
--pretrained-components icenode_configs/pretrained_components_rcs.json \
--cpu 

mkdir $PBS_O_WORKDIR/$PBS_JOBID
cp * $PBS_O_WORKDIR/$PBS_JOBID
